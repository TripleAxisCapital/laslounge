<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eros Gate — Tasteful Art Gallery</title>
  <meta name="description" content="A single‑file, Apple‑style, tasteful art gallery with an elegant 18+ entry gate, fullscreen lightbox, lazy‑loading masonry layout, and zero dependencies. Drop images into /gallery and go." />
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#0B0B0B">
  <style>
    /* ---------------------------------------------------------
       Eros Gate — Single-File Apple-Style Gallery (No deps)
       Host on GitHub Pages. Put your images in /gallery.

       Optional (recommended): create /gallery-manifest.json like:
       {
         "title": "Eros Gallery",
         "hero": "gallery/cover.jpg",
         "images": [
           {"src":"gallery/set1/001.jpg","caption":"Rose Light","tags":["set1","rose"]},
           {"src":"gallery/set1/002.jpg"},
           "gallery/solo/IMG_0231.webp"
         ]
       }

       Fallback (if no manifest): we scan common patterns in /gallery
       (IMG_0001.jpg, image-1.jpg, photo (1).jpg, etc.) with a sane cap.

       Accessibility, reduced motion, and mobile PASSED.  
       --------------------------------------------------------- */

    :root{
      --ink:#0b0b0b;           /* rich black */
      --paper:#ffffff;         /* pure white */
      --soft:#f5f6f7;          /* soft surface */
      --line:rgba(0,0,0,.08);  /* hairline */
      --tint:#dcdcdc;          /* light stroke */
      --accent:#ff385c;        /* elegant pop (can change) */
      --accent-ink:#fff;
      --gate-grad: radial-gradient(120% 120% at 50% 0%, #111 0%, #0b0b0b 35%, #000 100%);
      --radius: 16px;
    }
    @media (prefers-color-scheme:dark){
      :root{ --paper:#0a0a0a; --soft:#0f0f10; --line:rgba(255,255,255,.08); --tint:#2a2a2c; }
      body{ color:#f3f3f3; }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font: 16px/1.45 -apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,"Segoe UI Emoji";
      color:var(--ink); background:var(--paper);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    a{color:inherit}

    /* ---------- Header ---------- */
    header.site{
      position:sticky; top:0; z-index:40; backdrop-filter:saturate(180%) blur(14px);
      background:color-mix(in srgb, var(--paper) 78%, transparent);
      border-bottom:1px solid var(--line);
    }
    .bar{display:flex; align-items:center; justify-content:space-between; gap:12px; max-width:1200px; margin:0 auto; padding:12px 20px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:600; letter-spacing:.2px}
    .brand .dot{width:10px; height:10px; border-radius:50%; background:var(--accent); box-shadow:0 0 0 4px color-mix(in srgb, var(--accent) 18%, transparent)}
    .nav{display:flex; gap:8px; align-items:center}
    .chip{padding:8px 12px; border:1px solid var(--line); border-radius:999px; background:color-mix(in srgb, var(--soft) 60%, transparent); cursor:pointer; user-select:none}
    .chip[aria-pressed="true"]{background:var(--ink); color:#fff; border-color:transparent}
    .search{position:relative; min-width:180px}
    .search input{width:100%; padding:10px 12px 10px 34px; border-radius:999px; border:1px solid var(--line); background:var(--soft); outline:none}
    .search svg{position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:.7}

    /* ---------- Hero ---------- */
    .hero{max-width:1200px; margin:24px auto 8px; padding:0 20px}
    .title{font-size: clamp(36px, 6vw, 64px); line-height:1.04; font-weight:700; letter-spacing:-.5px; margin:6px 0}
    .sub{opacity:.7; margin:0}

    /* ---------- Masonry Gallery ---------- */
    .gallery{max-width:1200px; margin:24px auto 120px; padding:0 20px}
    .masonry{column-gap:16px}
    .masonry-1{column-count:1}
    .masonry-2{column-count:2}
    .masonry-3{column-count:3}
    .masonry-4{column-count:4}
    .masonry-5{column-count:5}
    @media (max-width:1200px){ .masonry-5{column-count:4} }
    @media (max-width:980px){ .masonry-4,.masonry-5{column-count:3} }
    @media (max-width:720px){ .masonry-3,.masonry-4,.masonry-5{column-count:2} }
    @media (max-width:520px){ .masonry-2,.masonry-3,.masonry-4,.masonry-5{column-count:1} }

    figure.card{position:relative; break-inside:avoid; margin:0 0 16px 0; border-radius:20px; overflow:hidden; background:var(--soft); border:1px solid var(--line)}
    figure.card img{display:block; width:100%; height:auto; opacity:0; transform:translateY(6px) scale(.98); filter:blur(6px); transition:opacity .5s ease, transform .6s cubic-bezier(.2,.8,.2,1), filter .7s ease}
    figure.card img.loaded{opacity:1; transform:none; filter:blur(0)}
    figcaption{position:absolute; left:0; right:0; bottom:0; padding:10px 12px; background:linear-gradient(to top, rgba(0,0,0,.45), rgba(0,0,0,0)); color:#fff; font-size:12px; letter-spacing:.2px}
    .badge{position:absolute; top:10px; left:10px; font-size:11px; padding:4px 8px; border-radius:999px; background:rgba(0,0,0,.55); color:#fff; backdrop-filter: blur(6px)}
    .hover{position:absolute; inset:0; opacity:0; transition:opacity .3s ease}
    figure.card:hover .hover{opacity:1}

    /* ---------- Lightbox ---------- */
    .lightbox{position:fixed; inset:0; z-index:60; display:none; place-items:center; background:rgba(0,0,0,.92)}
    .lightbox.open{display:grid}
    .lb-stage{position:relative; width:100%; height:100%; display:grid; place-items:center}
    .lb-img{max-width:96vw; max-height:90vh; object-fit:contain; will-change:transform}
    .lb-ui{position:absolute; left:0; right:0; top:0; display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 14px; color:#fff}
    .lb-ui .tray{display:flex; gap:8px; align-items:center}
    .icon-btn{display:inline-grid; place-items:center; width:36px; height:36px; border-radius:10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); cursor:pointer}
    .icon-btn:hover{background:rgba(255,255,255,.12)}
    .lb-caption{position:absolute; left:0; right:0; bottom:0; color:#fff; padding:10px 14px; opacity:.9; text-shadow:0 1px 0 rgba(0,0,0,.6)}

    /* ---------- 18+ Gate ---------- */
    .gate{position:fixed; inset:0; z-index:100; display:grid; place-items:center; background:var(--gate-grad); color:#f7f7f7}
    .gate::before{content:""; position:absolute; inset:-20%; background:radial-gradient(80% 60% at 50% 40%, rgba(255,255,255,.06), transparent 62%); filter:blur(30px); opacity:.7; pointer-events:none}
    .gate-doors{position:absolute; inset:0; perspective:1200px; overflow:hidden}
    .door{position:absolute; top:0; bottom:0; width:52vw; background:linear-gradient( to bottom, rgba(255,255,255,.06), rgba(255,255,255,.01) ),
           repeating-linear-gradient( 90deg, rgba(255,255,255,.08) 0 1px, transparent 1px 40px );
          border:1px solid rgba(255,255,255,.10); box-shadow:inset 0 0 60px rgba(0,0,0,.35)}
    .door.left{left:0; transform-origin:left center;}
    .door.right{right:0; transform-origin:right center;}
    .crest{position:absolute; inset:auto; top:48px; left:50%; transform:translateX(-50%); width:min(520px, 86vw); height:120px; border-radius:18px; border:1px solid rgba(255,255,255,.14); backdrop-filter: blur(10px); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); display:grid; place-items:center; box-shadow:0 10px 40px rgba(0,0,0,.35)}
    .crest h1{margin:0; font-size:clamp(22px, 4vw, 28px); letter-spacing:2px; font-weight:600}
    .gate-content{position:relative; text-align:center; padding:20px; z-index:1}
    .gate h2{margin:0 0 8px 0; font-size:clamp(40px,6vw,60px); letter-spacing:.4px}
    .gate p{margin:0 0 22px 0; opacity:.85}
    .cta{display:inline-flex; gap:10px}
    .btn{appearance:none; border:1px solid rgba(255,255,255,.16); color:#fff; background:rgba(255,255,255,.05); padding:12px 18px; border-radius:999px; cursor:pointer; font-weight:600}
    .btn.primary{background:var(--accent); border-color:color-mix(in srgb, var(--accent) 70%, #000 30%)}
    .gate-note{font-size:12px; opacity:.7; margin-top:10px}

    /* Gate animations */
    .gate.ready .door{transform:translateZ(0)}
    .gate.opening .door.left{animation:doorLeft 1.8s cubic-bezier(.2,.9,.2,1) forwards}
    .gate.opening .door.right{animation:doorRight 1.8s cubic-bezier(.2,.9,.2,1) forwards}
    .gate.opening .gate-content{animation:fadeUp .7s ease .8s forwards}
    .gate.done{display:none}

    @keyframes doorLeft{ 0%{ transform:rotateY(0) translateX(0)} 60%{transform:rotateY(-12deg) translateX(-40%)} 100%{ transform:rotateY(-16deg) translateX(-120%) } }
    @keyframes doorRight{ 0%{ transform:rotateY(0) translateX(0)} 60%{transform:rotateY(12deg) translateX(40%)} 100%{ transform:rotateY(16deg) translateX(120%) } }
    @keyframes fadeUp{ from{ opacity:1; filter:blur(0)} to{opacity:0; filter:blur(10px)} }

    /* Site reveal blur-fade after gate */
    .reveal-wrap{filter:blur(18px); opacity:0; transform:translateY(8px); transition:filter .9s ease, opacity .9s ease, transform .9s ease}
    .reveal-wrap.revealed{filter:blur(0); opacity:1; transform:none}

    /* Empty state */
    .empty{max-width:780px; margin:40px auto; padding:20px; text-align:center; border:1px dashed var(--tint); border-radius:16px; background:color-mix(in srgb, var(--soft) 60%, transparent)}
    .empty code{background:rgba(0,0,0,.06); padding:2px 6px; border-radius:6px}

    /* Footer */
    footer{border-top:1px solid var(--line); padding:30px 20px; color:rgba(0,0,0,.6)}
    @media (prefers-color-scheme:dark){ footer{color:rgba(255,255,255,.65)} }

    /* Reduced motion respectfully disables big moves */
    @media (prefers-reduced-motion:reduce){
      .gate.opening .door.left, .gate.opening .door.right{animation:none}
      .gate{display:none}
      .reveal-wrap{filter:none; opacity:1; transform:none}
    }
  </style>
</head>
<body>
  <!-- 18+ GATE -->
  <div id="age-gate" class="gate ready" role="dialog" aria-modal="true" aria-labelledby="gate-h">
    <div class="gate-doors" aria-hidden="true">
      <div class="door left"></div>
      <div class="door right"></div>
    </div>
    <div class="crest"><h1>Eros • Curated Erotic Art</h1></div>
    <div class="gate-content">
      <h2 id="gate-h">Enter if you are 18+</h2>
      <p>By entering you confirm you are of legal age and consent to view tasteful, adult‑oriented artwork.</p>
      <div class="cta">
        <button class="btn primary" id="enterBtn" aria-label="Enter the site">Enter</button>
        <a class="btn" href="https://www.wikipedia.org" rel="noopener">Exit</a>
      </div>
      <div class="gate-note">Your choice is remembered on this device.</div>
    </div>
  </div>

  <!-- SITE WRAP (revealed after gate) -->
  <div id="site" class="reveal-wrap" aria-hidden="true">
    <header class="site" role="banner">
      <div class="bar">
        <div class="brand" aria-label="Site brand">
          <span class="dot" aria-hidden="true"></span>
          <span>Eros</span>
        </div>
        <nav class="nav" aria-label="Filters">
          <button class="chip" data-filter="all" aria-pressed="true">All</button>
          <button class="chip" data-filter="tag:set">Sets</button>
          <button class="chip" data-filter="tag:solo">Solo</button>
        </nav>
        <div class="search" role="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-4.2-4.2M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
          <input id="q" type="search" placeholder="Search titles, tags…" aria-label="Search gallery" />
        </div>
      </div>
    </header>

    <section class="hero" aria-label="Hero">
      <h1 class="title">Curated. Minimal. Eternal.</h1>
      <p class="sub">An elegant, Apple‑style gallery for sophisticated erotic art. Drop your photos into <code>/gallery</code> and publish.</p>
    </section>

    <section class="gallery" aria-label="Gallery">
      <div id="grid" class="masonry masonry-4" aria-live="polite"></div>
      <div id="empty" class="empty" hidden>
        <h3>No images found yet</h3>
        <p>To get started, create a <code>gallery</code> folder at your site root and drop your <strong>JPG/PNG/WebP/AVIF</strong> files inside.</p>
        <p>Recommended: add <code>gallery-manifest.json</code> with an <code>images</code> array for perfect control (see comment in source). Otherwise, we’ll auto‑scan common filenames.</p>
        <p>Host on GitHub Pages? Just push and you’re live.</p>
      </div>
    </section>

    <!-- Lightbox / Fullscreen Viewer -->
    <div id="lightbox" class="lightbox" aria-hidden="true" aria-label="Image viewer">
      <div class="lb-stage">
        <div class="lb-ui">
          <div class="tray">
            <button class="icon-btn" id="lbPrev" title="Previous (←)" aria-label="Previous">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 19l-7-7 7-7" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="icon-btn" id="lbNext" title="Next (→)" aria-label="Next">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 5l7 7-7 7" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
          <div class="tray">
            <button class="icon-btn" id="lbFS" title="Fullscreen (F)" aria-label="Toggle fullscreen">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 3H5a2 2 0 0 0-2 2v4M21 9V5a2 2 0 0 0-2-2h-4M15 21h4a2 2 0 0 0 2-2v-4M3 15v4a2 2 0 0 0 2 2h4" stroke="#fff" stroke-width="1.6" stroke-linecap="round"/></svg>
            </button>
            <a class="icon-btn" id="lbDL" title="Download" aria-label="Download" download>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v12m0 0 4-4m-4 4-4-4M4 21h16" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </a>
            <button class="icon-btn" id="lbClose" title="Close (Esc)" aria-label="Close">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6l12 12M18 6L6 18" stroke="#fff" stroke-width="1.6" stroke-linecap="round"/></svg>
            </button>
          </div>
        </div>
        <img id="lbImg" class="lb-img" alt="" />
        <div id="lbCap" class="lb-caption"></div>
      </div>
    </div>

    <footer>
      <div style="max-width:1200px; margin:0 auto">
        <small>© <span id="year"></span> Eros. All rights reserved. Content for adults 18+ only. <a href="#" id="resetGate">Reset age gate</a>.</small>
      </div>
    </footer>
  </div>

  <script>
  (function(){
    const CONFIG = {
      folder: 'gallery',
      manifest: 'gallery-manifest.json',
      txtlist: 'gallery.txt',
      scanLimit: 360,           // total images max for fallback scanning
      missStreakLimit: 18,      // stop pattern if many misses
      columns: 4,               // default desktop columns
    };

    const state = {
      images: /** @type {{src:string,caption?:string,tags?:string[]}[]} */([]),
      filtered: [],
      ix: 0, open:false,
    };

    const $ = sel => document.querySelector(sel);
    const grid = $('#grid');
    const empty = $('#empty');

    /* ---------------- AGE GATE ---------------- */
    const gate = $('#age-gate');
    const site = $('#site');
    const enterBtn = $('#enterBtn');

    function openGate(){
      gate.classList.add('opening');
      // after doors open, hide gate and reveal site
      setTimeout(()=>{
        gate.classList.add('done');
        site.removeAttribute('aria-hidden');
        site.classList.add('revealed');
      }, 1800);
    }

    function initGate(){
      const ok = localStorage.getItem('eros_age_ok') === 'true';
      if(ok){ gate.classList.add('done'); site.removeAttribute('aria-hidden'); site.classList.add('revealed'); return; }
      enterBtn.addEventListener('click', ()=>{
        localStorage.setItem('eros_age_ok','true');
        openGate();
      });
    }

    $('#resetGate').addEventListener('click', (e)=>{ e.preventDefault(); localStorage.removeItem('eros_age_ok'); alert('Age gate reset for this browser. Reload to see the gate again.'); });

    /* ---------------- DATA LOADERS ---------------- */
    async function fetchMaybe(url, opt){ try{ const r = await fetch(url, opt); if(!r.ok) return null; return r; }catch{ return null; } }

    async function tryManifest(){
      const r = await fetchMaybe(CONFIG.manifest, {cache:'no-store'});
      if(!r) return false;
      const json = await r.json().catch(()=>null);
      if(!json || !json.images) return false;
      document.title = (json.title ? json.title + ' — ' : '') + document.title;
      for(const item of json.images){
        if(typeof item === 'string') state.images.push({src:item});
        else if(item && item.src) state.images.push({src:item.src, caption:item.caption, tags:item.tags||[]});
      }
      return state.images.length>0;
    }

    async function tryTxtList(){
      const r = await fetchMaybe(CONFIG.txtlist, {cache:'no-store'});
      if(!r) return false;
      const txt = await r.text();
      const lines = txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
      for(const src of lines){ state.images.push({src}); }
      return state.images.length>0;
    }

    const exts=['jpg','jpeg','png','webp','avif'];
    async function exists(path){ const r = await fetchMaybe(path, {method:'HEAD', cache:'no-store'}); return !!(r && r.ok); }

    async function scanPattern(prefix, start, end, pad, exts){
      let misses=0, found=0;
      for(let n=start; n<=end && state.images.length<CONFIG.scanLimit; n++){
        let num = pad ? String(n).padStart(pad,'0') : String(n);
        let hit = false;
        for(const ext of exts){
          const p = `${CONFIG.folder}/${prefix}${num}.${ext}`;
          // eslint-disable-next-line no-await-in-loop
          if(await exists(p)){ state.images.push({src:p}); hit=true; found++; break; }
        }
        if(!hit){ misses++; if(misses>=CONFIG.missStreakLimit && found===0) break; }
      }
    }

    async function fallbackScan(){
      // Common camera/file export naming patterns
      await scanPattern('IMG_', 1, 9999, 4, exts);    // IMG_0001.jpg
      await scanPattern('image-', 1, 2000, 0, exts);  // image-1.jpg
      await scanPattern('photo (', 1, 2000, 0, exts); // photo (1).jpg -> handle closing ) below
      // fix any with missing ')' from above attempt
      state.images = state.images.map(it=> it.src.includes('photo (') && !it.src.includes(')') ? ({...it, src: it.src.replace(/photo \((\d+)/,'photo ($1)')}) : it);
      await scanPattern('DSC_', 1, 9999, 4, exts);    // DSC_0001.jpg
      await scanPattern('', 1, 300, 0, exts);         // 1.jpg
    }

    /* ---------------- RENDER ---------------- */
    function setColumns(){
      const w = window.innerWidth; let c = 4;
      if(w>=1300) c=5; else if(w>=980) c=4; else if(w>=720) c=3; else if(w>=520) c=2; else c=1;
      grid.className = `masonry masonry-${c}`;
    }

    const io = new IntersectionObserver((entries)=>{
      for(const e of entries){ if(e.isIntersecting){ const img = e.target; img.src = img.dataset.src; img.onload=()=>img.classList.add('loaded'); io.unobserve(img); } }
    }, {rootMargin:'120px 0px'});

    function figure({src, caption, tags}, idx){
      const f = document.createElement('figure'); f.className='card'; f.dataset.index = String(idx);
      const b = document.createElement('div'); b.className='hover'; f.appendChild(b);
      const img = document.createElement('img'); img.loading='lazy'; img.decoding='async'; img.alt = caption || src.split('/').pop(); img.dataset.src = src; io.observe(img); f.appendChild(img);
      if(caption){ const cap = document.createElement('figcaption'); cap.textContent = caption; f.appendChild(cap); }
      if(tags && tags.length){ const bad = document.createElement('div'); bad.className='badge'; bad.textContent=tags[0]; f.appendChild(bad); f.dataset.tags = tags.join(','); }
      f.addEventListener('click', ()=> openLightbox(idx));
      return f;
    }

    function render(list){
      grid.innerHTML='';
      if(!list.length){ empty.hidden=false; return; } else empty.hidden=true;
      const frag = document.createDocumentFragment();
      list.forEach((it,i)=> frag.appendChild( figure(it, i) ));
      grid.appendChild(frag);
    }

    /* ---------------- FILTER & SEARCH ---------------- */
    function bindFilters(){
      const chips = document.querySelectorAll('.chip');
      chips.forEach(ch=>{
        ch.addEventListener('click', ()=>{
          chips.forEach(x=>x.setAttribute('aria-pressed','false'));
          ch.setAttribute('aria-pressed','true');
          applyFilter(ch.dataset.filter, $('#q').value.trim());
        })
      })
      $('#q').addEventListener('input', (e)=>{
        const active = document.querySelector('.chip[aria-pressed="true"]');
        applyFilter(active?.dataset.filter, e.target.value.trim());
      })
    }

    function applyFilter(filter, q){
      let list = [...state.images];
      if(filter && filter.startsWith('tag:')){
        const want = filter.split(':')[1];
        list = list.filter(it=> (it.tags||[]).some(t=>t.toLowerCase().includes(want)));
      }
      if(q){ const Q = q.toLowerCase(); list = list.filter(it=> (it.caption||'').toLowerCase().includes(Q) || it.src.toLowerCase().includes(Q) || (it.tags||[]).some(t=>t.toLowerCase().includes(Q))); }
      state.filtered = list; render(list);
    }

    /* ---------------- LIGHTBOX ---------------- */
    const lb = $('#lightbox'); const lbImg = $('#lbImg'); const lbCap=$('#lbCap');
    const lbPrev = $('#lbPrev'); const lbNext = $('#lbNext'); const lbClose=$('#lbClose'); const lbFS=$('#lbFS'); const lbDL=$('#lbDL');

    function openLightbox(idx){ state.ix=idx; lb.classList.add('open'); lb.setAttribute('aria-hidden','false'); showIx(); document.addEventListener('keydown', onKey); }
    function closeLightbox(){ lb.classList.remove('open'); lb.setAttribute('aria-hidden','true'); document.removeEventListener('keydown', onKey); }
    function onKey(e){ if(e.key==='Escape') closeLightbox(); else if(e.key==='ArrowRight') next(); else if(e.key==='ArrowLeft') prev(); else if(e.key.toLowerCase()==='f') toggleFS(); }
    function prev(){ state.ix = (state.ix - 1 + state.filtered.length) % state.filtered.length; showIx(-1); }
    function next(){ state.ix = (state.ix + 1) % state.filtered.length; showIx(1); }
    function showIx(dir=0){ const it = state.filtered[state.ix]; lbImg.style.opacity='0'; lbImg.src = it.src; lbImg.alt = it.caption || it.src.split('/').pop(); lbImg.onload=()=>{ lbImg.animate([{opacity:0, filter:'blur(6px)'},{opacity:1, filter:'blur(0)'}], {duration:400, easing:'ease'}); lbImg.style.opacity='1'; }; lbCap.textContent = it.caption || ''; lbDL.href = it.src; }
    function toggleFS(){ const el = document.fullscreenElement; if(!el) lb.requestFullscreen?.(); else document.exitFullscreen?.(); }

    lbPrev.addEventListener('click', prev); lbNext.addEventListener('click', next); lbClose.addEventListener('click', closeLightbox); lbFS.addEventListener('click', toggleFS);
    lb.addEventListener('click', (e)=>{ if(e.target===lb) closeLightbox(); });

    /* ---------------- INIT ---------------- */
    async function main(){
      initGate();
      setColumns();
      window.addEventListener('resize', setColumns);
      bindFilters();

      let ok = await tryManifest();
      if(!ok) ok = await tryTxtList();
      if(!ok) await fallbackScan();
      if(state.images.length===0){ empty.hidden=false; return; }
      state.filtered = [...state.images];
      render(state.filtered);
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      main(); $('#year').textContent = new Date().getFullYear();
    });
  })();
  </script>
</body>
</html>
